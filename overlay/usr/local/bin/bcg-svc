#!/bin/sh

set -euo pipefail


#======================================================================================================================
# Check arguments.
#   1   Control action 'disable', 'restart', 'start', 'stop'
#   2   Service name
#======================================================================================================================

[[ -z "${1-}" ]] && bcg-error "You must provide the control action." "bcg-svc"
[[ -z "${2-}" ]] && bcg-error "You must provide the name of a service." "bcg-svc"


#======================================================================================================================
# Check environment variable.
#======================================================================================================================

[[ -z "${S6_SERVICES-}" ]] && bcg-error "S6_SERVICES environment variable is not set." "bcg-svc" \
    || SVC=${S6_SERVICES}/${2}


#======================================================================================================================
# Control a supervised service.
#======================================================================================================================

[[ ! -d ${SVC} ]] && bcg-error "Service '${2}' does not exist." "bcg-svc"

case ${1} in

    disable)
        bcg-echo "Disabling ${2} service..." "bcg-svc"
        s6-svc -d ${SVC}
        bcg-done "bcg-svc"
        ;;

    restart)
        bcg-echo "Restarting ${2} service..." "bcg-svc"
        s6-svc -r ${SVC}
        ;;

    start)
        bcg-echo "Starting ${2} service..." "bcg-svc"
        s6-svc -u ${SVC}
        ;;

    stop)
        bcg-echo "Stopping ${2} service..." "bcg-svc"
        s6-svc -t ${SVC}
        bcg-done "bcg-svc"
        ;;

    *)
        bcg-error "Unknown control action '${1}'." "bcg-svc"
        ;;

esac
