#!/bin/sh

set -euo pipefail


#======================================================================================================================
# Check argument.
#======================================================================================================================

[[ -z "${1-}" ]] && bcg-error "bcg-tz: You must provide a timezone."


#======================================================================================================================
# Set the timezone.
#
# Arguments
#   1   Valid timezone (e.g. Europe/London)
#======================================================================================================================

# remove timezone packages and clear zone info
clear() {
    apk del .tz
    rm -rf /usr/share/zoneinfo/*
}

# install timezone package
apk add --no-cache --virtual .tz tzdata

# check the specified timezone exists
TZ="/usr/share/zoneinfo/${1}"
if [ ! -f ${TZ} ] ; then
    clear
    bcg-error "bcg-tz: ${1} is not a recognised timezone."
fi

# copy timezone info
bcg-echo "Setting timezone to ${1}..."
cp "${TZ}" /etc/localtime
clear
bcg-done
