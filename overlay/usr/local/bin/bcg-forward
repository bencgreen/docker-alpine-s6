#!/bin/sh

set -euo pipefail

#======================================================================================================================
# Check arguments.
#   1   Service name
#   2   Absolute path to log file
#======================================================================================================================

[[ -z "${1-}" ]] && bcg-error "bcg-forward: You must provide the name of the log service directory."
if [ -z "${2-}" ] ; then
    bcg-echo "bcg-forward: Path to log file not defined, disabling ${1}"
    bcg-disable "${1}"
    exit 0
fi


#======================================================================================================================
# Forward the contents of a log file to Docker.
#======================================================================================================================

bcg-echo "Forwarding ${1}..."

if [ -f ${2} ] ; then
    bcg-debug "bcg-forward: ${2}"
    exec tail -F "${2}"
else
    SLEEP=5
    bcg-debug "bcg-forward: ${2} not found, sleeping for ${SLEEP}s"
    sleep ${SLEEP}
fi
