#!/bin/sh

set -euo pipefail

#======================================================================================================================
# Check arguments.
#   1   Service name
#   2   Absolute path to log file
#======================================================================================================================

[[ -z "${1-}" ]] && bcg-error "You must provide the name of the log service directory." "bcg-forward"
if [ -z "${2-}" ] ; then
    bcg-echo "Path to log file not defined, disabling ${1}" "bcg-forward"
    bcg-disable "${1}"
    exit 0
fi


#======================================================================================================================
# Forward the contents of a log file to Docker.
#======================================================================================================================

bcg-echo "Forwarding ${1}..." "bcg-forward"

if [ -f ${2} ] ; then
    bcg-debug "${2}" "bcg-forward"
    exec tail -F "${2}"
else
    SLEEP=5
    bcg-debug "${2} not found, sleeping for ${SLEEP}s" "bcg-forward"
    sleep ${SLEEP}
fi
